Recode with MongoDB and better architecture